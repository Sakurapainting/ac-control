C51 COMPILER V9.54   MAIN                                                                  12/28/2025 11:40:37 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main.l
                    -st) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <reg52.h>
   2          #include <intrins.h>
   3          typedef unsigned char uchar;
   4          typedef unsigned int  uint;
   5          
   6          sbit DHT11_DATA = P3^0;  
   7          sbit IN1  = P2^0; 
   8          sbit IN2  = P2^1;
   9          sbit IN3  = P2^2; 
  10          sbit IN4  = P2^3;
  11          sbit ENA  = P2^4; 
  12          sbit ENB  = P2^5;
  13          sbit IN1_C = P1^0; 
  14          sbit IN2_C = P1^1;
  15          sbit ENA_C = P1^2;
  16          
  17          uchar humi_int;  // 湿度整数位 0-99
  18          uchar temp_int;  // 温度整数位 0-99
  19          uchar humi_deci; // DHT11小数位固定0
  20          uchar temp_deci; // DHT11小数位固定0
  21          uchar check_sum; // 校验位
  22          
  23          void Delay_1us(void)    // 12MHz
  24          {
  25   1          _nop_();
  26   1      }
  27          
  28          void Delay_ms(uint ms)  // 12MHz
  29          {
  30   1              uint i,j;
  31   1              for(i=ms; i>0; i--)
  32   1                      for(j=120; j>0; j--);
  33   1      }
  34          
  35          uchar DHT11_Read(void)
  36          {
  37   1              uchar i, j, buf[5] = {0};
  38   1              // 主机发送起始信号
  39   1              DHT11_DATA = 0;
  40   1              Delay_ms(20);
  41   1              DHT11_DATA = 1;
  42   1              Delay_1us();Delay_1us();Delay_1us();Delay_1us();
  43   1              
  44   1              // 等待DHT11应答
  45   1              while(DHT11_DATA == 1);
  46   1              while(DHT11_DATA == 0);
  47   1              while(DHT11_DATA == 1);
  48   1              
  49   1              // 读取40位数据 高位先出
  50   1              for(i=0; i<5; i++)
  51   1              {
  52   2                      for(j=0; j<8; j++)
  53   2                      {
  54   3                              while(DHT11_DATA == 0);
C51 COMPILER V9.54   MAIN                                                                  12/28/2025 11:40:37 PAGE 2   

  55   3                              Delay_1us();Delay_1us();Delay_1us();Delay_1us();Delay_1us();
  56   3                              buf[i] <<= 1;
  57   3                              if(DHT11_DATA == 1) buf[i] |= 1;
  58   3                              while(DHT11_DATA == 1);
  59   3                      }
  60   2              }
  61   1              
  62   1              // 数据校验赋值
  63   1              humi_int = buf[0];
  64   1              humi_deci = buf[1];
  65   1              temp_int = buf[2];
  66   1              temp_deci = buf[3];
  67   1              check_sum = buf[4];
  68   1              
  69   1              if((humi_int + humi_deci + temp_int + temp_deci) == check_sum)
  70   1                      return 1; // 校验成功，数据有效
  71   1              else
  72   1                      return 0; // 校验失败，数据无效
  73   1      }
  74          
  75          void Motor_Init(void)   // 电机初始化，上电全部停止，默认低电平
  76          {
  77   1              IN1=0;IN2=0;ENA=0;
  78   1              IN3=0;IN4=0;ENB=0;
  79   1              IN1_C=0;IN2_C=0;ENA_C=0;
  80   1      }
  81          
  82          // 电机A 正转(制冷)
  83          void MotorA_ON(void)
  84          {
  85   1              IN1 = 1;
  86   1              IN2 = 0;
  87   1              ENA = 1;
  88   1      }
  89          void MotorA_OFF(void){IN1=0;IN2=0;ENA=0;}
  90          
  91          // 电机B 正转(制热)
  92          void MotorB_ON(void)
  93          {
  94   1              IN3 = 1;
  95   1              IN4 = 0;
  96   1              ENB = 1;
  97   1      }
  98          void MotorB_OFF(void){IN3=0;IN4=0;ENB=0;}
  99          
 100          // 电机C 正转(除湿)
 101          void MotorC_ON(void)
 102          {
 103   1              IN1_C = 1;
 104   1              IN2_C = 0;
 105   1              ENA_C = 1;
 106   1      }
 107          void MotorC_OFF(void){IN1_C=0;IN2_C=0;ENA_C=0;}
 108          
 109          void Temp_Humi_Ctrl(void)
 110          {
 111   1              // 制冷：温度>30℃ 开电机A，否则关闭
 112   1              if(temp_int > 30)  MotorA_ON();
 113   1              else               MotorA_OFF();
 114   1              
 115   1              // 制热：温度<20℃ 开电机B，否则关闭
 116   1              if(temp_int < 20)  MotorB_ON();
C51 COMPILER V9.54   MAIN                                                                  12/28/2025 11:40:37 PAGE 3   

 117   1              else               MotorB_OFF();
 118   1              
 119   1              // 除湿：湿度>60% 开电机C，否则关闭
 120   1              if(humi_int > 60)  MotorC_ON();
 121   1              else               MotorC_OFF();
 122   1      }
 123          
 124          /*********************主函数 程序入口*********************/
 125          void main(void)
 126          {
 127   1              Motor_Init();  // 上电初始化所有电机停止
 128   1              while(1)      
 129   1              {
 130   2                      if(DHT11_Read() == 1)  // 成功读取有效温湿度数据
 131   2                      {
 132   3                              Temp_Humi_Ctrl();   // 执行电机控制逻辑
 133   3                      }
 134   2                      Delay_ms(1000);         // 1秒采集一次
 135   2              }
 136   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    309    ----
   CONSTANT SIZE    =      5    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
